{% extends "portfolios/base.html" %}
{% load portfolio_tags %}

{% block content %}
<!-- Profile Header Section -->
<div class="card p-4 p-md-5 shadow-sm mb-5">
    <div class="text-center">
        {% if portfolio.profile_image %}
            <img src="{{ portfolio.profile_image.url }}" alt="{{ portfolio.full_name }}" class="img-fluid rounded-circle mb-4" style="width: 150px; height: 150px; object-fit: cover;">
        {% endif %}
        <h1 class="display-5 fw-bold">{{ portfolio.full_name }}</h1>
        <p class="lead text-muted">{{ portfolio.title }}</p>

        {% if portfolio.bio %}
            <p class="my-4 mx-auto" style="max-width: 600px;">{{ portfolio.bio }}</p>
        {% endif %}

        <div class="d-flex justify-content-center gap-2 mb-4">
            {% if portfolio.email %}
                <a href="mailto:{{ portfolio.email }}" class="btn btn-outline-primary">ðŸ“§ Email Me</a>
            {% endif %}
            {% if portfolio.linkedin_url %}
                 <a href="{{ portfolio.linkedin_url }}" target="_blank" class="btn btn-outline-primary">ðŸ”— LinkedIn</a>
            {% endif %}
        </div>
        <a href="{% url 'landing' %}" class="btn btn-sm btn-success">âœ¨ Create Your Own Portfolio</a>
    </div>
</div>

<!-- Interactive Timeline Section -->
<div class="mt-5">
    <h2 class="text-center text-white mb-5">Career Timeline</h2>

    {% if grouped_events %}
        <div class="timeline-container-centered">
            {% for year, events_in_year in grouped_events.items %}

                <!-- This is the corrected, easy-to-read logic -->
                {% if forloop.counter|divisibleby:2 %}
                    <!-- BLOCK FOR EVEN-NUMBERED ITEMS (2, 4, 6...): will appear on the LEFT -->
                    <div class="timeline-block timeline-block-left">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="card border-0">
                                <div class="card-header bg-transparent border-0 p-3">
                                    <button class="btn btn-link text-decoration-none w-100 text-start fs-5 fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-year-{{ year }}">
                                        {{ year }}
                                    </button>
                                </div>
                                <div id="collapse-year-{{ year }}" class="collapse">
                                    <div class="card-body p-3">
                                        {% for event in events_in_year %}
                                            <div class="mb-3">
                                                <h6 class="fw-bold">{{ event.title }}</h6>
                                                <p class="mb-1 text-muted"><strong>{{ event.company }}</strong></p>
                                                <small class="text-muted">{{ event.start_date|date:"F Y" }} â€“ {% if event.end_date %}{{ event.end_date|date:"F Y" }}{% else %}Present{% endif %}</small>
                                            </div>
                                            {% if not forloop.last %}<hr>{% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                {% else %}
                    <!-- BLOCK FOR ODD-NUMBERED ITEMS (1, 3, 5...): will appear on the RIGHT -->
                    <div class="timeline-block timeline-block-right">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="card border-0">
                                <div class="card-header bg-transparent border-0 p-3">
                                    <button class="btn btn-link text-decoration-none w-100 text-start fs-5 fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-year-{{ year }}">
                                        {{ year }}
                                    </button>
                                </div>
                                <div id="collapse-year-{{ year }}" class="collapse">
                                    <div class="card-body p-3">
                                        {% for event in events_in_year %}
                                            <div class="mb-3">
                                                <h6 class="fw-bold">{{ event.title }}</h6>
                                                <p class="mb-1 text-muted"><strong>{{ event.company }}</strong></p>
                                                <small class="text-muted">{{ event.start_date|date:"F Y" }} â€“ {% if event.end_date %}{{ event.end_date|date:"F Y" }}{% else %}Present{% endif %}</small>
                                            </div>
                                            {% if not forloop.last %}<hr>{% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

            {% endfor %}
        </div>
    {% else %}
        <!-- Fallback message for when there are no events -->
        <div class="card my-4 text-center">
            <div class="card-body p-5">
                <p class="lead">This portfolio doesn't have any timeline events yet.</p>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}